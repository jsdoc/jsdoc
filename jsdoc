#!/bin/sh
#
# Arguments:
#   any argument supported by jsdoc.js
#
#   -modules path        path where rhino looks up require.js modules 
#
#                        include more than once in the parameter list if 
#                        multiple paths have to be configured.
#      
# 

SOURCE="$0"
while [ -h "$SOURCE" ] ; do
  NEXTSOURCE="$(readlink "$SOURCE")"
  echo $NEXTSOURCE | grep -q -e "^/"
  if [ $? = 0 ]; then
    SOURCE="$NEXTSOURCE"
  else
    SOURCE="$(dirname $SOURCE)/$NEXTSOURCE"
  fi
done
# Get a Windows path under MinGW or Cygwin
BASEPATH="$( cd -P "$( dirname "$SOURCE" )" && (pwd -W 2>/dev/null || cygpath -w $(pwd) 2>/dev/null || pwd))"
if [ "${BASEPATH%${BASEPATH#?}}" != "/" ] ; then
  BASEPATH="$( echo "$BASEPATH" | sed -e 's@\\@/@g' )"
fi

if test "$1" = "--debug"
then
    CMD="org.mozilla.javascript.tools.debugger.Main -debug -opt -1"
else
    CMD="org.mozilla.javascript.tools.shell.Main"
fi

if test "$1" = "-T"
then
    cd -P "$(dirname "$SOURCE")"
    java -classpath "${BASEPATH}/rhino/js.jar" ${CMD} -opt -1 -modules "${BASEPATH}/lib" -modules "${BASEPATH}/node_modules" -modules "${BASEPATH}/rhino" -modules "${BASEPATH}" "${BASEPATH}/jsdoc.js" "$@"

else
    JSDOC_ARGS=""
    EXT_MODULES=""
    while [ $# != 0 ]; do
      case "$1" in 
        -modules) 
          if [ -n "$2" ]; then
            EXT_MODULES="$EXT_MODULES -modules $2"
            shift 2
          else
            echo "warning: missing value for argument '-modules'"
            shift
          fi
        ;;
        *)
          JSDOC_ARGS="$JSDOC_ARGS $1"
          shift
          ;;
      esac
    done
    echo EXT_MODULES=$EXT_MODULES
    java -classpath "${BASEPATH}/rhino/js.jar" ${CMD} ${EXT_MODULES} -modules "${BASEPATH}/lib" -modules "${BASEPATH}/node_modules" -modules "${BASEPATH}/rhino" -modules "${BASEPATH}" "${BASEPATH}/jsdoc.js" $JSDOC_ARGS
fi

